


additions, removals = diff(activeToday, activeYesterday)


for dates:
    activeToday = polygodGetALLtickersafsadsfa

    for sec in additoins:
        if figi & figi in db:
            if ticker == ticker:
                "shit data"
            else:
                diagnoses = "ticker change"

        else if ticker in db && any trades between db.maxDate and yesterday:
            diagnoses = "shit data"
        else
            diagnoses = "listing"

        
        if diagnoses = listing:
            "INSERT INTO securities (figi, ticker, minDate) values ($1,$2,$3)",sec.figi, sec.ticker, todaysDates)
        else if diagnoses == "ticker change":
            INSERT INTO securities ("securityId, figi, ticker, minDate) SELECT securityID, $1, $2, $3 where figi = $3", sec.figi, sec.ticker, todaysDates
        else if diagnoses = "shit data"
            UPDATE securites set maxDate = NULL where ticker = $1 order by maxDate desc, sec.ticker




    for sec in removals:
        UPDATE securities SET maxDate = todaysDate where ticker = sec.ticker and maxDate = null


    activeYesterday = activeToday

